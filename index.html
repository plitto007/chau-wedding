<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wedding Invitation | Ngọc Châu & Việt Anh</title>
    
    <!-- CẬP NHẬT: Sử dụng file favicon.ico -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,400&family=Great+Vibes&family=Montserrat:wght@300;400&display=swap" rel="stylesheet">

    <!-- Cấu hình Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'wedding-gold': '#E8C675', 
                        'wedding-pink': '#FDE8E8',
                        'wedding-dark': '#2C2C2C',
                        'cream': '#FDFBF7',
                    },
                    fontFamily: {
                        'script': ['"Great Vibes"', 'cursive'],
                        'serif': ['"Cormorant Garamond"', 'serif'],
                        'sans': ['"Montserrat"', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        /* --- Global Styles & Animations --- */
        body {
            background-color: #FDFBF7;
            overflow-x: hidden;
        }

        /* Hiệu ứng Parallax cho Hero */
        .parallax-bg {
            background-image: url('bgr.jpg'); /* Ảnh mặc định cho PC */
            background-attachment: fixed;
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
        }

        /* CẬP NHẬT: Responsive Background cho Mobile */
        @media (max-width: 768px) {
            .parallax-bg {
                background-image: url('bgr-mobile.jpg'); /* Ảnh dọc cho mobile */
                background-attachment: scroll; /* Tắt fixed trên mobile để tránh lỗi giật hình trên iOS */
            }
        }

        /* Custom Text Shadow */
        .text-glow {
            text-shadow: 0 0 10px rgba(255,255,255,0.3), 0 2px 4px rgba(0,0,0,0.5);
        }

        /* Hiệu ứng Scroll Reveal */
        .reveal {
            opacity: 0;
            transform: translateY(50px);
            transition: all 1s ease-out;
        }
        .reveal.active {
            opacity: 1;
            transform: translateY(0);
        }

        /* Hoa rơi */
        .petal {
            position: fixed;
            top: -10%;
            background-color: #ffb7b2;
            width: 15px;
            height: 15px;
            border-radius: 15px 0px;
            opacity: 0.8;
            z-index: 9999;
            pointer-events: none;
            animation: falling linear infinite;
        }
        @keyframes falling {
            0% { transform: translate(0, 0) rotate(0deg); opacity: 1; }
            100% { transform: translate(100px, 100vh) rotate(720deg); opacity: 0; }
        }

        /* Vinyl Record Animation */
        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin-slow {
            animation: spin-slow 4s linear infinite;
        }

        /* Vinyl Texture */
        .vinyl-texture {
            background: repeating-radial-gradient(
                #111 0, 
                #111 2px, 
                #333 3px, 
                #333 4px
            );
        }
        
        /* Hiệu ứng nốt nhạc bay lên */
        @keyframes float-note {
            0% {
                transform: translateY(0) rotate(0deg) scale(0.8);
                opacity: 0;
            }
            20% {
                opacity: 1;
            }
            100% {
                transform: translateY(-60px) rotate(20deg) scale(1.2);
                opacity: 0;
            }
        }
        
        .music-note {
            position: absolute;
            bottom: 50%;
            left: 50%;
            color: #E8C675; /* wedding-gold */
            pointer-events: none;
            animation: float-note 2s ease-out forwards;
            z-index: 40;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #C5A059; border-radius: 4px; }

        /* Lightbox transition optimized */
        .lightbox-fade { transition: opacity 0.2s ease-in-out; }
    </style>
</head>
<body class="text-wedding-dark antialiased font-serif">

    <!-- Music Player Control -->
    <div class="fixed bottom-6 right-6 z-50 flex flex-col items-center justify-center">
        <div id="note-container" class="absolute w-full h-full pointer-events-none"></div>
        <button id="music-toggle" class="group relative w-20 h-20 rounded-full flex items-center justify-center bg-transparent focus:outline-none transform hover:scale-105 transition-transform duration-300 shadow-2xl">
            <div id="vinyl-record" class="absolute inset-0 rounded-full vinyl-texture border-4 border-wedding-gold shadow-lg flex items-center justify-center overflow-hidden">
                <div class="absolute inset-0 bg-gradient-to-tr from-white/20 via-transparent to-transparent pointer-events-none z-10"></div>
                <div class="absolute w-8 h-8 rounded-full bg-wedding-pink border-2 border-wedding-gold flex items-center justify-center z-20 shadow-inner">
                    <div class="w-1.5 h-1.5 rounded-full bg-black"></div>
                </div>
            </div>
            <div id="control-icon" class="relative z-30 text-white text-2xl drop-shadow-[0_2px_2px_rgba(0,0,0,0.8)] opacity-90 group-hover:opacity-100 transition-opacity">
                <i class="fas fa-music"></i>
            </div>
        </button>
        <audio id="bg-music"></audio>
    </div>

    <!-- Hoa rơi container -->
    <div id="petals-container"></div>

    <!-- 1. HERO SECTION -->
    <header class="parallax-bg h-screen relative flex items-center justify-center text-center px-4">
        <!-- Overlay tối hơn để nổi chữ -->
        <div class="absolute inset-0 bg-black/60"></div> 
        
        <div class="relative z-10 text-white animate-fade-in-up">
            <p class="text-xl md:text-2xl tracking-[0.2em] uppercase font-light mb-4 reveal active">Save The Date</p>
            
            <h1 class="font-script text-6xl md:text-8xl lg:text-9xl mb-2 text-wedding-pink text-glow reveal active" style="transition-delay: 0.2s;">
                Ngọc Châu
            </h1>
            <div class="text-4xl md:text-5xl my-2 font-light text-wedding-gold text-glow reveal active" style="transition-delay: 0.4s;">&</div>
            <h1 class="font-script text-6xl md:text-8xl lg:text-9xl mb-8 text-wedding-pink text-glow reveal active" style="transition-delay: 0.6s;">
                Việt Anh
            </h1>

            <div class="inline-block border-t border-b border-white/50 py-4 px-8 mt-6 backdrop-blur-sm bg-white/10 rounded-lg reveal active" style="transition-delay: 0.8s;">
                <p class="text-2xl md:text-3xl font-semibold text-shadow-md">20 . 12 . 2025</p>
                <p class="text-sm md:text-base mt-2 tracking-widest uppercase text-shadow-md">Thung Lũng Hoa Hồ Tây, Hà Nội</p>
            </div>
        </div>

        <div class="absolute bottom-10 left-1/2 transform -translate-x-1/2 animate-bounce text-white/80">
            <i class="fas fa-chevron-down text-2xl"></i>
        </div>
    </header>

    <!-- 2. INTRO -->
    <section class="py-20 md:py-32 px-6 text-center bg-cream relative overflow-hidden">
        <div class="absolute top-0 left-0 w-32 h-32 border-t-2 border-l-2 border-wedding-gold opacity-30 rounded-tl-3xl m-8"></div>
        <div class="absolute bottom-0 right-0 w-32 h-32 border-b-2 border-r-2 border-wedding-gold opacity-30 rounded-br-3xl m-8"></div>

        <div class="max-w-3xl mx-auto reveal">
            <i class="fas fa-quote-left text-4xl text-wedding-gold mb-6 opacity-50"></i>
            <p class="text-2xl md:text-3xl italic leading-relaxed text-gray-700 mb-6">
                "Hạnh phúc không phải là điểm đến, mà là hành trình chúng ta đi cùng nhau. 
                Cảm ơn đời đã mang ta đến bên nhau để cùng viết nên câu chuyện cổ tích này."
            </p>
            <div class="w-24 h-1 bg-wedding-gold mx-auto my-8"></div>
            <p class="font-sans text-sm tracking-widest text-gray-500 uppercase">Trân trọng kính mời quý khách đến dự lễ thành hôn của chúng tôi</p>
        </div>
    </section>

    <!-- 3. COUNTDOWN -->
    <section class="py-16 bg-[url('https://www.transparenttextures.com/patterns/cream-paper.png')] bg-wedding-pink/20">
        <div class="container mx-auto px-4 text-center reveal">
            <h2 class="font-script text-5xl md:text-6xl text-wedding-dark mb-12">Cùng đếm ngược giây phút hạnh phúc</h2>
            <div id="countdown" class="flex flex-wrap justify-center gap-6 md:gap-10">
                <div class="bg-white/80 backdrop-blur rounded-full w-24 h-24 md:w-32 md:h-32 flex flex-col justify-center items-center shadow-xl border border-white">
                    <span id="days" class="text-3xl md:text-4xl font-bold text-wedding-gold">00</span>
                    <span class="text-xs uppercase tracking-wide mt-1">Ngày</span>
                </div>
                <div class="bg-white/80 backdrop-blur rounded-full w-24 h-24 md:w-32 md:h-32 flex flex-col justify-center items-center shadow-xl border border-white">
                    <span id="hours" class="text-3xl md:text-4xl font-bold text-wedding-gold">00</span>
                    <span class="text-xs uppercase tracking-wide mt-1">Giờ</span>
                </div>
                <div class="bg-white/80 backdrop-blur rounded-full w-24 h-24 md:w-32 md:h-32 flex flex-col justify-center items-center shadow-xl border border-white">
                    <span id="minutes" class="text-3xl md:text-4xl font-bold text-wedding-gold">00</span>
                    <span class="text-xs uppercase tracking-wide mt-1">Phút</span>
                </div>
                <div class="bg-white/80 backdrop-blur rounded-full w-24 h-24 md:w-32 md:h-32 flex flex-col justify-center items-center shadow-xl border border-white">
                    <span id="seconds" class="text-3xl md:text-4xl font-bold text-wedding-gold">00</span>
                    <span class="text-xs uppercase tracking-wide mt-1">Giây</span>
                </div>
            </div>
        </div>
    </section>

    <!-- 4. EVENTS -->
    <section class="py-20 md:py-32 bg-white">
        <div class="container mx-auto px-4">
            <h2 class="font-script text-5xl md:text-7xl text-center text-wedding-gold mb-20 reveal">Sự Kiện Chính</h2>
            
            <div class="relative max-w-4xl mx-auto">
                <div class="absolute left-1/2 transform -translate-x-1/2 h-full w-0.5 bg-gray-200 hidden md:block"></div>

                <!-- Event 1: Lễ Ăn Hỏi -->
                <div class="relative md:flex justify-between items-center mb-16 md:mb-24 reveal">
                    <div class="md:w-5/12 text-center md:text-right order-1 pr-0 md:pr-10">
                        <div class="inline-block p-2 border border-wedding-gold rounded-full mb-4">
                            <i class="fas fa-glass-cheers text-2xl text-wedding-gold w-8 h-8 flex items-center justify-center"></i>
                        </div>
                        <h3 class="text-3xl font-bold mb-2 text-gray-800">Lễ Ăn Hỏi</h3>
                        <p class="font-sans text-wedding-gold font-bold mb-2">16:00 PM - 20/12/2025</p>
                        <p class="text-gray-600 mb-4">Tư gia nhà gái.<br>Nghi thức truyền thống ấm cúng cùng gia đình.</p>
                        <a href="https://maps.app.goo.gl/5qaXTtw1h9QcZWaVA" target="_blank" class="inline-block px-6 py-2 border border-wedding-dark hover:bg-wedding-dark hover:text-white transition duration-300 rounded-full text-sm uppercase tracking-wider">Xem Bản Đồ</a>
                    </div>
                    <div class="hidden md:flex absolute left-1/2 transform -translate-x-1/2 w-4 h-4 bg-wedding-gold rounded-full border-4 border-white shadow-md z-10"></div>
                    <div class="md:w-5/12 order-2 mt-6 md:mt-0 pl-0 md:pl-10">
                        <img src="https://images.unsplash.com/photo-1515934751635-c81c6bc9a2d8?q=80&w=1170&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Lễ Ăn Hỏi" class="rounded-lg shadow-lg w-full h-64 object-cover hover:scale-105 transition duration-500">
                    </div>
                </div>

                <!-- Event 2: Lễ Vu Quy -->
                <div class="relative md:flex justify-between items-center reveal">
                    <div class="md:w-5/12 order-2 md:order-1 mt-6 md:mt-0 pr-0 md:pr-10">
                         <img src="https://images.unsplash.com/photo-1715521801560-f1183fa95199?q=80&w=687&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Lễ Vu Quy" class="rounded-lg shadow-lg w-full h-64 object-cover hover:scale-105 transition duration-500">
                    </div>
                    <div class="hidden md:flex absolute left-1/2 transform -translate-x-1/2 w-4 h-4 bg-wedding-gold rounded-full border-4 border-white shadow-md z-10"></div>
                    <div class="md:w-5/12 text-center md:text-left order-1 md:order-2 pl-0 md:pl-10">
                        <div class="inline-block p-2 border border-wedding-gold rounded-full mb-4">
                            <i class="fas fa-utensils text-2xl text-wedding-gold w-8 h-8 flex items-center justify-center"></i>
                        </div>
                        <h3 class="text-3xl font-bold mb-2 text-gray-800">Lễ Vu Quy</h3>
                        <p class="font-sans text-wedding-gold font-bold mb-2">08:30 AM - 21/12/2025</p>
                        <p class="text-gray-600 mb-4">Trung tâm tiệc cưới Thung Lũng Hoa Hồ Tây.<br>Kính mời quý khách tham dự bữa tiệc thân mật.</p>
                        <a href="https://maps.app.goo.gl/V8JybfmnszpTDvu48" target="_blank" class="inline-block px-6 py-2 border border-wedding-dark hover:bg-wedding-dark hover:text-white transition duration-300 rounded-full text-sm uppercase tracking-wider">Xem Bản Đồ</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- 5. GALLERY (Auto Slide + Lazy Load) -->
    <section class="py-24 bg-cream overflow-hidden">
        <div class="container mx-auto px-4 text-center">
            <h2 class="font-script text-5xl md:text-6xl text-center text-wedding-dark mb-4 reveal">Khoảnh Khắc Đẹp</h2>
            <p class="text-center text-gray-500 mb-16 font-sans italic reveal">Lưu giữ từng giây phút yêu thương</p>
            
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 md:gap-6 auto-rows-[280px] mb-12">
                <!-- Ảnh 1 -->
                <div class="reveal md:col-span-2 md:row-span-2 relative group z-0 hover:z-20 transition-all duration-500 cursor-pointer" onclick="openLightboxFromId('gallery-img-1')">
                    <div class="bg-white p-4 shadow-xl transform -rotate-2 group-hover:rotate-0 group-hover:scale-105 transition-all duration-500 h-full">
                        <img id="gallery-img-1" src="images/gallery/image_1.jpg" loading="lazy" class="w-full h-full object-cover transition-all duration-1000">
                    </div>
                </div>
                <!-- Ảnh 2 -->
                <div class="reveal md:col-span-1 md:row-span-1 relative group z-0 hover:z-20 transition-all duration-500 mt-6 md:mt-0 cursor-pointer" onclick="openLightboxFromId('gallery-img-2')">
                    <div class="bg-white p-3 shadow-lg transform rotate-3 group-hover:rotate-0 group-hover:scale-110 transition-all duration-500 h-full">
                        <img id="gallery-img-2" src="images/gallery/image_2.jpg" loading="lazy" class="w-full h-full object-cover transition-all duration-1000">
                    </div>
                </div>
                <!-- Ảnh 3 -->
                <div class="reveal md:col-span-1 md:row-span-2 relative group z-0 hover:z-20 transition-all duration-500 md:translate-y-12 cursor-pointer" onclick="openLightboxFromId('gallery-img-3')">
                    <div class="bg-white p-3 shadow-lg transform -rotate-1 group-hover:rotate-0 group-hover:scale-105 transition-all duration-500 h-full">
                        <img id="gallery-img-3" src="images/gallery/image_3.jpg" loading="lazy" class="w-full h-full object-cover transition-all duration-1000">
                    </div>
                </div>
                <!-- Ảnh 4 -->
                <div class="reveal md:col-span-1 md:row-span-1 relative group z-0 hover:z-20 transition-all duration-500 cursor-pointer" onclick="openLightboxFromId('gallery-img-4')">
                    <div class="bg-white p-3 shadow-lg transform -rotate-3 group-hover:rotate-0 group-hover:scale-110 transition-all duration-500 h-full">
                        <img id="gallery-img-4" src="images/gallery/image_4.jpg" loading="lazy" class="w-full h-full object-cover transition-all duration-1000">
                    </div>
                </div>
                 <!-- Ảnh 5 -->
                 <div class="reveal md:col-span-2 md:row-span-1 relative group z-0 hover:z-20 transition-all duration-500 cursor-pointer" onclick="openLightboxFromId('gallery-img-5')">
                    <div class="bg-white p-4 shadow-xl transform rotate-1 group-hover:rotate-0 group-hover:scale-105 transition-all duration-500 h-full">
                        <img id="gallery-img-5" src="images/gallery/image_5.jpg" loading="lazy" class="w-full h-full object-cover transition-all duration-1000">
                    </div>
                </div>
                 <!-- Ảnh 6 -->
                 <div class="reveal md:col-span-1 md:row-span-1 relative group z-0 hover:z-20 transition-all duration-500 mt-6 md:mt-0 cursor-pointer" onclick="openLightboxFromId('gallery-img-6')">
                    <div class="bg-white p-3 shadow-lg transform -rotate-2 group-hover:rotate-0 group-hover:scale-110 transition-all duration-500 h-full">
                        <img id="gallery-img-6" src="images/gallery/image_6.jpg" loading="lazy" class="w-full h-full object-cover transition-all duration-1000">
                    </div>
                </div>
                <!-- Ảnh 7 -->
                <div class="reveal md:col-span-1 md:row-span-1 relative group z-0 hover:z-20 transition-all duration-500 mt-6 md:mt-0 cursor-pointer" onclick="openLightboxFromId('gallery-img-7')">
                    <div class="bg-white p-3 shadow-lg transform rotate-2 group-hover:rotate-0 group-hover:scale-110 transition-all duration-500 h-full">
                        <img id="gallery-img-7" src="images/gallery/image_7.jpg" loading="lazy" class="w-full h-full object-cover transition-all duration-1000">
                    </div>
                </div>
            </div>

            <button onclick="openLightbox(0)" class="inline-block border-2 border-wedding-gold text-wedding-dark hover:bg-wedding-gold hover:text-white py-3 px-8 rounded-full font-sans tracking-widest text-sm uppercase transition duration-300 transform hover:scale-105 reveal">
                Xem Tất Cả Ảnh
            </button>
        </div>
    </section>

    <!-- 6. WISHES (GUESTBOOK) -->
    <section class="py-20 bg-white relative">
        <div class="container mx-auto px-4">
            <h2 class="font-script text-5xl md:text-6xl text-center text-wedding-gold mb-6 reveal">Sổ Lưu Bút</h2>
            <p class="text-center text-gray-500 mb-12 font-sans italic reveal">Gửi lời chúc phúc đến cô dâu & chú rể</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-12 max-w-5xl mx-auto">
                <div class="reveal">
                    <div class="bg-cream p-8 rounded-2xl shadow-lg border border-wedding-pink h-full">
                        <h3 class="font-serif text-2xl mb-6 text-wedding-dark font-bold"><i class="fas fa-pen-nib text-wedding-gold mr-2"></i> Gửi lời yêu thương</h3>
                        <form id="wish-form" class="space-y-6" onsubmit="handleWishSubmit(event)">
                            <div>
                                <label class="block text-sm uppercase tracking-wider text-gray-500 mb-2">Tên của bạn</label>
                                <input type="text" id="wisher-name" class="w-full bg-white border border-gray-200 rounded-lg px-4 py-3 focus:outline-none focus:border-wedding-gold focus:ring-1 focus:ring-wedding-gold transition" placeholder="Ví dụ: Bạn thân hồi cấp 3..." required>
                            </div>
                            <div>
                                <label class="block text-sm uppercase tracking-wider text-gray-500 mb-2">Lời chúc</label>
                                <textarea id="wisher-message" rows="4" class="w-full bg-white border border-gray-200 rounded-lg px-4 py-3 focus:outline-none focus:border-wedding-gold focus:ring-1 focus:ring-wedding-gold transition resize-none" placeholder="Chúc hai bạn trăm năm hạnh phúc..." required></textarea>
                            </div>
                            <button type="submit" class="w-full bg-wedding-dark text-white font-bold py-3 rounded-lg hover:bg-wedding-gold transition duration-300 shadow-md">
                                Gửi Lời Chúc
                            </button>
                        </form>
                    </div>
                </div>

                <div class="reveal">
                    <div class="bg-white p-6 rounded-2xl shadow-inner border border-gray-100 h-full flex flex-col">
                        <h3 class="font-serif text-2xl mb-6 text-wedding-dark font-bold border-b pb-4"><i class="fas fa-heart text-wedding-pink mr-2"></i> Lời chúc mới nhất</h3>
                        <div id="wishes-container" class="flex-1 overflow-y-auto pr-2 space-y-4 max-h-[400px] scroll-smooth">
                            <!-- Loading Indicator ban đầu -->
                            <div id="wishes-loading" class="text-center text-gray-500 italic py-4">
                                <i class="fas fa-spinner fa-spin mr-2"></i> Đang tải lời chúc...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- 7. FOOTER -->
    <footer class="bg-wedding-dark text-white py-12 text-center">
        <h2 class="font-script text-4xl mb-4 text-wedding-pink">Ngọc Châu & Việt Anh</h2>
        <div class="flex justify-center space-x-6 mb-6">
            <a href="#" class="hover:text-wedding-gold transition"><i class="fab fa-facebook-f"></i></a>
            <a href="#" class="hover:text-wedding-gold transition"><i class="fab fa-instagram"></i></a>
        </div>
        <p class="text-xs text-gray-400 font-sans tracking-widest uppercase">Thank you for being part of our journey</p>
    </footer>

    <!-- LIGHTBOX MODAL -->
    <div id="lightbox" class="fixed inset-0 z-[100] bg-black/95 hidden flex items-center justify-center lightbox-fade opacity-0">
        <button onclick="closeLightbox()" class="absolute top-6 right-6 text-white/70 hover:text-white text-4xl z-[110] transition-colors p-2">
            <i class="fas fa-times"></i>
        </button>
        <button onclick="navigateLightbox(-1)" class="absolute left-2 md:left-10 text-white/50 hover:text-white text-4xl md:text-6xl z-[110] p-4 transition-colors">
            <i class="fas fa-chevron-left"></i>
        </button>
        <button onclick="navigateLightbox(1)" class="absolute right-2 md:right-10 text-white/50 hover:text-white text-4xl md:text-6xl z-[110] p-4 transition-colors">
            <i class="fas fa-chevron-right"></i>
        </button>
        <div class="relative max-w-[95vw] max-h-[95vh]">
            <img id="lightbox-img" src="" class="max-w-full max-h-[90vh] object-contain shadow-2xl border-4 border-white/10 rounded-sm transition-opacity duration-300">
            <div class="absolute bottom-[-30px] left-0 w-full text-center text-white/60 font-sans text-sm tracking-widest">
                <span id="lightbox-counter">1 / 12</span>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT -->
    <script>
        // 1. SCROLL REVEAL
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('active');
                }
            });
        });
        document.querySelectorAll('.reveal').forEach((el) => observer.observe(el));

        // 2. COUNTDOWN
        const weddingDate = new Date("2025-12-20T16:00:00").getTime();
        function updateCountdown() {
            const now = new Date().getTime();
            const diff = weddingDate - now;
            if (diff > 0) {
                document.getElementById("days").innerText = Math.floor(diff / (1000 * 60 * 60 * 24)).toString().padStart(2, '0');
                document.getElementById("hours").innerText = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)).toString().padStart(2, '0');
                document.getElementById("minutes").innerText = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60)).toString().padStart(2, '0');
                document.getElementById("seconds").innerText = Math.floor((diff % (1000 * 60)) / 1000).toString().padStart(2, '0');
            }
        }
        setInterval(updateCountdown, 1000);
        updateCountdown();

        // 3. FALLING PETALS
        function createPetal() {
            const petal = document.createElement('div');
            petal.classList.add('petal');
            petal.style.left = Math.random() * 100 + 'vw';
            petal.style.animationDuration = Math.random() * 3 + 2 + 's';
            petal.style.opacity = Math.random();
            petal.style.backgroundColor = ['#ffc0cb', '#ffb7b2', '#ffd1dc'][Math.floor(Math.random() * 3)];
            document.getElementById('petals-container').appendChild(petal);
            setTimeout(() => { petal.remove(); }, 5000);
        }
        setInterval(createPetal, 300);

        // 4. MUSIC PLAYER
        const musicBtn = document.getElementById('music-toggle');
        const vinylRecord = document.getElementById('vinyl-record');
        const controlIcon = document.getElementById('control-icon');
        const audio = document.getElementById('bg-music');
        const noteContainer = document.getElementById('note-container');
        let isPlaying = false;
        let noteInterval;

        const playlist = ['musics/music_1.mp3', 'musics/music_2.mp3', 'musics/music_3.mp3'];

        function updateMusicUI(playing) {
            if (playing) {
                vinylRecord.classList.add('animate-spin-slow');
                controlIcon.innerHTML = '<i class="fas fa-pause"></i>';
                if (!noteInterval) noteInterval = setInterval(spawnNotes, 800);
            } else {
                vinylRecord.classList.remove('animate-spin-slow');
                controlIcon.innerHTML = '<i class="fas fa-music"></i>';
                clearInterval(noteInterval);
                noteInterval = null;
            }
        }

        function playRandomSong() {
            const randomIndex = Math.floor(Math.random() * playlist.length);
            audio.src = playlist[randomIndex];
            // Fix: Check if play returns a promise
            const playPromise = audio.play();
            if (playPromise !== undefined) {
                return playPromise;
            }
            // If browser doesn't return promise, assume it works or fires error event
            return Promise.resolve();
        }

        function spawnNotes() {
            const note = document.createElement('div');
            note.innerHTML = '<i class="fas fa-music"></i>';
            note.className = 'music-note text-2xl'; 
            const randomX = (Math.random() - 0.5) * 40; 
            note.style.left = `calc(50% + ${randomX}px)`;
            noteContainer.appendChild(note);
            setTimeout(() => { note.remove(); }, 2000); 
        }

        // Add error listener to audio element to catch loading errors and stop UI
        audio.addEventListener('error', function(e) {
            console.warn("Không thể tải file nhạc. Vui lòng kiểm tra thư mục musics/.", e);
            isPlaying = false;
            updateMusicUI(false); 
        });

        musicBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            if (isPlaying) {
                audio.pause();
                isPlaying = false;
                updateMusicUI(false);
            } else {
                let playPromise;
                if (!audio.src || audio.src === window.location.href) { 
                    playPromise = playRandomSong();
                } else {
                    playPromise = audio.play();
                }
                
                if (playPromise !== undefined) {
                    playPromise
                        .then(() => {
                            isPlaying = true;
                            updateMusicUI(true);
                        })
                        .catch(error => {
                            console.warn("Playback prevented or failed:", error);
                            isPlaying = false;
                            updateMusicUI(false);
                        });
                }
            }
        });

        audio.addEventListener('ended', () => { 
            playRandomSong()
                .then(() => updateMusicUI(true))
                .catch(e => console.warn("Auto-switch failed:", e));
        });
        
        function attemptAutoplay() {
            playRandomSong()
                .then(() => {
                    isPlaying = true;
                    updateMusicUI(true);
                    console.log("Autoplay success!");
                })
                .catch(error => {
                    console.log("Autoplay blocked. Waiting for user interaction.");
                    const enableAudio = () => {
                        if (!isPlaying) {
                            playRandomSong()
                                .then(() => {
                                    isPlaying = true;
                                    updateMusicUI(true);
                                })
                                .catch(e => console.warn("Click play failed:", e));
                        }
                        document.removeEventListener('click', enableAudio);
                        document.removeEventListener('touchstart', enableAudio);
                        document.removeEventListener('scroll', enableAudio);
                    };
                    document.addEventListener('click', enableAudio);
                    document.addEventListener('touchstart', enableAudio); 
                });
        }
        window.addEventListener('load', attemptAutoplay);

        // 5. GALLERY AUTO SLIDE
        const galleryConfig = [
            { id: 'gallery-img-1', images: [{ src: 'images/gallery/image_1.jpg', pos: 'object-center' }, { src: 'images/gallery/image_7.jpg', pos: 'object-top' }], hiddenClass: ['opacity-0', 'scale-90'] },
            { id: 'gallery-img-2', images: [{ src: 'images/gallery/image_2.jpg', pos: 'object-center' }, { src: 'images/gallery/image_8.jpg', pos: 'object-center' }], hiddenClass: ['opacity-0', 'rotate-12'] },
            { id: 'gallery-img-3', images: [{ src: 'images/gallery/image_3.jpg', pos: 'object-center' }, { src: 'images/gallery/image_9.jpg', pos: 'object-center' }], hiddenClass: ['opacity-0', 'translate-y-4'] },
            { id: 'gallery-img-4', images: [{ src: 'images/gallery/image_4.jpg', pos: 'object-center' }, { src: 'images/gallery/image_10.jpg', pos: 'object-center' }], hiddenClass: ['opacity-0', 'blur-sm'] },
            { id: 'gallery-img-5', images: [{ src: 'images/gallery/image_5.jpg', pos: 'object-top' }, { src: 'images/gallery/image_10.jpg', pos: 'object-center' }], hiddenClass: ['opacity-0', 'scale-110'] },
            { id: 'gallery-img-6', images: [{ src: 'images/gallery/image_6.jpg', pos: 'object-top' }, { src: 'images/gallery/image_11.jpg', pos: 'object-center' }], hiddenClass: ['opacity-0', 'grayscale'] },
            { id: 'gallery-img-7', images: [{ src: 'images/gallery/image_7.jpg', pos: 'object-center' }, { src: 'images/gallery/image_12.jpg', pos: 'object-center' }], hiddenClass: ['opacity-0', 'rotate-6'] }
        ];

        let currentIndex = 0;
        setInterval(() => {
            galleryConfig.forEach(item => {
                const imgElement = document.getElementById(item.id);
                if (!imgElement) return;
                imgElement.classList.add(...item.hiddenClass);
                setTimeout(() => {
                    const nextImgIndex = (currentIndex + 1) % item.images.length;
                    const nextImgData = item.images[nextImgIndex];
                    imgElement.src = nextImgData.src;
                    imgElement.classList.remove('object-center', 'object-top', 'object-bottom', 'object-left', 'object-right');
                    imgElement.classList.add(nextImgData.pos || 'object-center');
                    setTimeout(() => { imgElement.classList.remove(...item.hiddenClass); }, 50);
                }, 1000);
            });
            currentIndex++;
        }, 3000);

        // 6. LIGHTBOX & WISHES
        const allGalleryImages = [
            'images/gallery/image_1.jpg', 'images/gallery/image_2.jpg', 'images/gallery/image_3.jpg', 
            'images/gallery/image_4.jpg', 'images/gallery/image_5.jpg', 'images/gallery/image_6.jpg', 
            'images/gallery/image_7.jpg', 'images/gallery/image_8.jpg', 'images/gallery/image_9.jpg', 
            'images/gallery/image_10.jpg', 'images/gallery/image_11.jpg', 'images/gallery/image_12.jpg'
        ];
        
        let currentLightboxIndex = 0;
        const lightbox = document.getElementById('lightbox');
        const lightboxImg = document.getElementById('lightbox-img');
        const lightboxCounter = document.getElementById('lightbox-counter');

        function openLightbox(index) {
            currentLightboxIndex = index;
            lightboxImg.src = allGalleryImages[currentLightboxIndex];
            lightboxCounter.innerText = `${currentLightboxIndex + 1} / ${allGalleryImages.length}`;
            lightbox.classList.remove('hidden');
            requestAnimationFrame(() => { lightbox.classList.remove('opacity-0'); });
            document.body.style.overflow = 'hidden'; 
            preloadImages(currentLightboxIndex);
        }

        function openLightboxFromId(imgId) {
            const imgEl = document.getElementById(imgId);
            if(imgEl) {
                const currentSrc = imgEl.getAttribute('src'); 
                let index = allGalleryImages.findIndex(src => src === currentSrc);
                if (index === -1) index = 0;
                openLightbox(index);
            }
        }

        function closeLightbox() {
            lightbox.classList.add('opacity-0');
            setTimeout(() => {
                lightbox.classList.add('hidden');
                document.body.style.overflow = 'auto'; 
            }, 200);
        }

        function navigateLightbox(step) {
            lightboxImg.classList.add('opacity-0');
            setTimeout(() => {
                currentLightboxIndex += step;
                if (currentLightboxIndex >= allGalleryImages.length) currentLightboxIndex = 0;
                else if (currentLightboxIndex < 0) currentLightboxIndex = allGalleryImages.length - 1;
                lightboxImg.src = allGalleryImages[currentLightboxIndex];
                lightboxCounter.innerText = `${currentLightboxIndex + 1} / ${allGalleryImages.length}`;
                lightboxImg.classList.remove('opacity-0');
                preloadImages(currentLightboxIndex);
            }, 300);
        }

        function preloadImages(index) {
            const nextIndex = (index + 1) % allGalleryImages.length;
            const prevIndex = (index - 1 + allGalleryImages.length) % allGalleryImages.length;
            new Image().src = allGalleryImages[nextIndex];
            new Image().src = allGalleryImages[prevIndex];
        }

        lightbox.addEventListener('click', (e) => { if (e.target === lightbox) closeLightbox(); });
        document.addEventListener('keydown', (e) => {
            if (lightbox.classList.contains('hidden')) return;
            if (e.key === 'Escape') closeLightbox();
            if (e.key === 'ArrowLeft') navigateLightbox(-1);
            if (e.key === 'ArrowRight') navigateLightbox(1);
        });

        // --- CẤU HÌNH GOOGLE SCRIPT URL ---
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzBCL9imkKgsu8Tro1gJBp5t_TE5-5Ej3YTCTlZPHsB-apWApkanDI-v5D51T82HJyGvg/exec"; 

        // Hàm tính thời gian tương đối - SỬA LỖI PARSE
        function timeAgo(dateStr) {
            if (!dateStr) return "Vừa xong";
            
            // Xử lý cả format ISO (Google Sheet trả về) và custom format
            let past = new Date(dateStr); // Thử parse chuẩn ISO 8601

            // Nếu parse thất bại (NaN), thử parse thủ công format "dd/MM/yyyy HH:mm:ss"
            if (isNaN(past.getTime())) {
                const parts = dateStr.split(' ');
                if (parts.length >= 2) {
                    const dParts = parts[0].split('/');
                    const tParts = parts[1].split(':');
                    if (dParts.length === 3 && tParts.length >= 2) {
                        past = new Date(dParts[2], dParts[1] - 1, dParts[0], tParts[0], tParts[1], tParts[2] || 0);
                    }
                }
            }
            
            // Nếu vẫn không được thì trả về nguyên gốc
            if (isNaN(past.getTime())) return dateStr;

            const now = new Date();
            const diffMs = now - past;
            const diffSeconds = Math.floor(diffMs / 1000);
            const diffMinutes = Math.floor(diffSeconds / 60);
            const diffHours = Math.floor(diffMinutes / 60);
            const diffDays = Math.floor(diffHours / 24);

            if (diffSeconds < 60) return "Vừa xong";
            if (diffMinutes < 60) return `${diffMinutes} phút trước`;
            if (diffHours < 24) return `${diffHours} giờ trước`;
            if (diffDays < 7) return `${diffDays} ngày trước`;
            
            return past.toLocaleDateString('vi-VN');
        }

        function renderWishItem(name, message, timeStr, isNew = false) {
            const wishItem = document.createElement('div');
            const borderColors = ['border-wedding-gold', 'border-wedding-pink', 'border-blue-300', 'border-green-300'];
            const randomBorder = borderColors[Math.floor(Math.random() * borderColors.length)];
            
            const animateClass = isNew ? 'animate-fade-in-up' : '';
            
            wishItem.className = `bg-white p-5 rounded-xl border-l-4 ${randomBorder} relative shadow-md ${animateClass} transform transition-all duration-500 mb-4`;
            
            let displayTime = "Vừa xong";
            if (timeStr && !isNew) {
                displayTime = timeAgo(timeStr);
            }

            // Tăng cỡ chữ: Tên (text-lg), Lời chúc (text-base), Thời gian (text-sm)
            wishItem.innerHTML = `
                <i class="fas fa-quote-right absolute top-4 right-4 text-wedding-pink/30 text-3xl"></i>
                <h4 class="font-bold text-wedding-dark text-lg mb-2">${name}</h4>
                <p class="text-gray-700 text-base italic leading-relaxed">"${message}"</p>
                <span class="text-sm text-gray-400 mt-3 block font-medium"><i class="far fa-clock mr-1"></i> ${displayTime}</span>
            `;
            return wishItem;
        }

        // Hàm tải danh sách lời chúc (Load Data)
        function loadWishes() {
            if (!GOOGLE_SCRIPT_URL) return;

            const container = document.getElementById('wishes-container');
            const loading = document.getElementById('wishes-loading');

            fetch(GOOGLE_SCRIPT_URL)
                .then(response => response.json())
                .then(data => {
                    // Xóa loading
                    if (loading) loading.remove();
                    container.innerHTML = '';
                    
                    if (data && data.length > 0) {
                        data.forEach(item => {
                            // item.name, item.message, item.time khớp với JSON từ doGet
                            const wishNode = renderWishItem(item.name, item.message, item.time, false);
                            container.appendChild(wishNode);
                        });
                    } else {
                        container.innerHTML = '<div class="text-center text-gray-400 italic py-4">Chưa có lời chúc nào. Hãy là người đầu tiên!</div>';
                    }
                })
                .catch(error => {
                    console.error("Lỗi tải lời chúc:", error);
                    if(loading) loading.innerHTML = '<span class="text-red-400">Không thể tải lời chúc.</span>';
                });
        }

        function handleWishSubmit(e) {
            e.preventDefault();
            const nameInput = document.getElementById('wisher-name');
            const msgInput = document.getElementById('wisher-message');
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const container = document.getElementById('wishes-container');
            const originalBtnText = submitBtn.innerText;

            const name = nameInput.value;
            const msg = msgInput.value;
            if(!name || !msg) return;

            submitBtn.innerText = 'Đang gửi...';
            submitBtn.disabled = true;

            // Hiển thị ngay lập tức (Optimistic UI)
            const wishItem = renderWishItem(name, msg, null, true);
            
            // Xóa thông báo "Chưa có lời chúc" hoặc Loading nếu còn
            if (container.children.length === 1 && container.children[0].classList.contains('text-center')) {
                 container.innerHTML = '';
            }
            
            container.insertBefore(wishItem, container.firstChild);
            container.scrollTop = 0;

            if (GOOGLE_SCRIPT_URL) {
                const params = new URLSearchParams();
                params.append('name', name);
                params.append('message', msg);

                fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    body: params,
                    mode: 'no-cors'
                })
                .then(() => {
                    alert("Cảm ơn bạn đã gửi lời chúc!");
                })
                .catch(error => {
                    console.error('Lỗi kết nối:', error);
                    alert("Có lỗi kết nối, nhưng lời chúc đã được hiển thị tạm thời.");
                })
                .finally(() => {
                    submitBtn.innerText = originalBtnText;
                    submitBtn.disabled = false;
                    nameInput.value = '';
                    msgInput.value = '';
                });
            } else {
                setTimeout(() => {
                    submitBtn.innerText = originalBtnText;
                    submitBtn.disabled = false;
                    nameInput.value = '';
                    msgInput.value = '';
                    alert("Cảm ơn bạn đã gửi lời chúc! (Chế độ Demo)");
                }, 500);
            }
        }

        // Khởi tạo khi trang load
        window.addEventListener('load', function() {
            attemptAutoplay();
            loadWishes(); // Gọi hàm tải lời chúc
        });
    </script>
</body>
</html>